<!DOCTYPE html>
<html lang="en-us">
    <head>
    <title>Transport for London with Emacs org-mode - Storax</title>
    <meta charset="utf-8" />
    <meta name="author" content="David Zuber" />
        <meta name="description" content="A Transport for London app for Emacs" />
        <meta name="keywords" content="Emacs, org-mode, tfl, London, emacs-lisp, svg" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
</head>

    <body class="container">
        <div>
    <header class="masthead">
        <h1 class="masthead-title"><a href="/">Storax</a></h1>
        <p>Eat sleep code repeat! Soon to be a major emacs mode.</p>
        <ul>
                <li><a href="/blog/">Blog</a></li>
            <li><a href="/tags/">Tags</a></li>
            <li><a href="/about/">About</a></li>
            <li><a href="https://github.com/storax">GitHub</a></li>
            <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="//www.google.com/search">
            <input type="text" class="field" name="q" id="s" placeholder="Search">
            <input type="hidden" name="as_sitesearch" value="storax.github.io">
        </form>
    </header>
</div>

        <div>
    <div class="post">
            <h1>Transport for London with Emacs org-mode</h1>
        <p>
Here is how I integrated the Transport for London API in Emacs. Enjoy!
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Motivation</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
I've moved to London in February. Some would say it's not London, it's Greater London.
The commute is about 50 minutes to work including walking.
Back in Stuttgart my trains would only run every half an hour so I had to plan every journey
to minimise my layover. I was afraid it would be the same in London,
and since I don't know the tube that well, I decided to plan in advance.
</p>

<p>
The <a href="https://tfl.gov.uk/">Transport for London website</a> is already very nice. But I have a regular schedule
and I don't want to type in the same input each day just to check my trains.
Also <code>org-mode</code> became more and more part of my daily workflow.
The agenda view is awesome and I wanted my commute to show up there.
</p>

<p>
At that time I was very new to lisp/emacs-lisp. It sometime took me 20 minutes to find out how
to manipulate some of the data structures. But in the end I learned a lot and now I can't stop
writing silly Emacs packages.
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">Transport for London API</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
That was actually a big surprise. The <a href="https://api-portal.tfl.gov.uk/">API</a> is simply awesome!
Yes, you can plan journeys. But there is actually much more.
344 traffic cams are available, live! You can get a <a href="http://www.tfl.gov.uk/tfl/livetravelnews/trafficcams/cctv/jamcams-camera-list.xml">xml file</a> with all of them listed.
</p>

<div class="org-src-container">

<pre class="src src-nxml">&lt;<span style="color: #93E0E3;">syndicatedFeed</span>&gt;
  &lt;<span style="color: #93E0E3;">header</span>&gt;
    &lt;<span style="color: #93E0E3;">identifier</span>&gt;TfL Traffic Cameras&lt;/<span style="color: #93E0E3;">identifier</span>&gt;
    &lt;<span style="color: #93E0E3;">version</span>&gt;0.1&lt;/<span style="color: #93E0E3;">version</span>&gt;
    &lt;<span style="color: #93E0E3;">publishDateTime</span>&gt;2016-04-24T11:18:11Z&lt;/<span style="color: #93E0E3;">publishDateTime</span>&gt;
    &lt;<span style="color: #93E0E3;">author</span>&gt;digital@tfl.gov.uk&lt;/<span style="color: #93E0E3;">author</span>&gt;
    &lt;<span style="color: #93E0E3;">owner</span>&gt;Transport for London&lt;/<span style="color: #93E0E3;">owner</span>&gt;
    &lt;<span style="color: #93E0E3;">refreshRate</span>&gt;1&lt;/<span style="color: #93E0E3;">refreshRate</span>&gt;
    &lt;<span style="color: #93E0E3;">max_Latency</span>&gt;10&lt;/<span style="color: #93E0E3;">max_Latency</span>&gt;
    &lt;<span style="color: #93E0E3;">timeToError</span>&gt;10&lt;/<span style="color: #93E0E3;">timeToError</span>&gt;
    &lt;<span style="color: #93E0E3;">overrideMessage</span>/&gt;
    &lt;<span style="color: #93E0E3;">errorMessage</span>/&gt;
    &lt;<span style="color: #93E0E3;">feedInfo</span>/&gt;
    &lt;<span style="color: #93E0E3;">logo</span>&gt;http://www.tfl.gov.uk/tfl-global/images/roundel.gif&lt;/<span style="color: #93E0E3;">logo</span>&gt;
  &lt;/<span style="color: #93E0E3;">header</span>&gt;
  &lt;<span style="color: #93E0E3;">cameraList</span> <span style="color: #DFAF8F;">updated</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">1461493091</span><span style="color: #CC9393;">"</span>&gt;
    &lt;<span style="color: #93E0E3;">rooturl</span>&gt;/tfl/livetravelnews/trafficcams/cctv/&lt;/<span style="color: #93E0E3;">rooturl</span>&gt;
    &lt;<span style="color: #93E0E3;">camera</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">00001.01251</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">available</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">true</span><span style="color: #CC9393;">"</span>&gt;
      &lt;<span style="color: #93E0E3;">corridor</span>&gt;-&lt;/<span style="color: #93E0E3;">corridor</span>&gt;
      &lt;<span style="color: #93E0E3;">location</span>&gt;Old Street e of Vince St&lt;/<span style="color: #93E0E3;">location</span>&gt;
      &lt;<span style="color: #93E0E3;">currentView</span>&gt;Test&lt;/<span style="color: #93E0E3;">currentView</span>&gt;
      &lt;<span style="color: #93E0E3;">file</span>&gt;00001.01251.jpg&lt;/<span style="color: #93E0E3;">file</span>&gt;
      &lt;<span style="color: #93E0E3;">captureTime</span>&gt;2016-04-24T10:15:21Z&lt;/<span style="color: #93E0E3;">captureTime</span>&gt;
      &lt;<span style="color: #93E0E3;">easting</span>&gt;532787&lt;/<span style="color: #93E0E3;">easting</span>&gt;
      &lt;<span style="color: #93E0E3;">northing</span>&gt;182600&lt;/<span style="color: #93E0E3;">northing</span>&gt;
      &lt;<span style="color: #93E0E3;">lat</span>&gt;51.5262&lt;/<span style="color: #93E0E3;">lat</span>&gt;
      &lt;<span style="color: #93E0E3;">lng</span>&gt;-0.08563&lt;/<span style="color: #93E0E3;">lng</span>&gt;
      &lt;<span style="color: #93E0E3;">osgr</span>&gt;TQ328826&lt;/<span style="color: #93E0E3;">osgr</span>&gt;
      &lt;<span style="color: #93E0E3;">postCode</span>/&gt;
    &lt;/<span style="color: #93E0E3;">camera</span>&gt;
  &lt;/<span style="color: #93E0E3;">cameraList</span>&gt;
&lt;/<span style="color: #93E0E3;">syndicatedFeed</span>&gt;
</pre>
</div>

<p>
Combining the <code>rooturl</code> with a <code>file</code> from the <code>camera</code> will get you a link like:
</p>

<pre class="example">
https://tfl.gov.uk/tfl/livetravelnews/trafficcams/cctv/00001.01251.jpg
</pre>


<div class="figure">
<p><img src="https://tfl.gov.uk/tfl/livetravelnews/trafficcams/cctv/00001.01251.jpg" alt="traffic cam footage" title="traffic cam" />
</p>
<p><span class="figure-number">Figure 1:</span> Live traffic camera footage</p>
</div>

<p>
There is a nice interactive <a href="https://api.tfl.gov.uk/">API explorer site</a>. What I needed was the <a href="https://api.tfl.gov.uk/#Journey">journey planner API</a>.
There are a lot of parameters but what you essentially need is something like this:
</p>

<pre class="example">
https://api.tfl.gov.uk/Journey/JourneyResults/Bank/to/Westminster
</pre>

<p>
This will try to retrieve a journey from Bank to Westminster.
The problem is that TfL knows way more than one Bank or Westminster station.
It will return a response with something like a 300 status code and a disambiguation result:
For each location type (to, from, via) there is a list with possible candidates.
The user has to select one of each and then you send a new request with the more precise
information.
</p>

<div class="org-src-container">

<pre class="src src-json"><span style="color: #DCDCCC;">{</span>
  <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.DisambiguationResult, Tfl.Api.Presentation.Entities"</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"toLocationDisambiguation"</span>: <span style="color: #BFEBBF;">{</span>
    <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Disambiguation, Tfl.Api.Presentation.Entities"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"disambiguationOptions"</span>: <span style="color: #D0BF8F;">[</span>
      <span style="color: #93E0E3;">{</span>
        <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.DisambiguationOption, Tfl.Api.Presentation.Entities"</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"parameterValue"</span>: "<span style="color: #BFEBBF;">1000266</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"uri"</span>: "\/journey\/journeyresults\/bank\/to\/<span style="color: #BFEBBF;">1000266</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"place"</span>: <span style="color: #9FC59F;">{</span>
          <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.StopPoint, Tfl.Api.Presentation.Entities"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"naptanId"</span>: <span style="color: #CC9393;">"HUBWSM"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"modes"</span>: <span style="color: #94BFF3;">[</span>
            <span style="color: #CC9393;">"tube"</span>
          <span style="color: #94BFF3;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"icsCode"</span>: "<span style="color: #BFEBBF;">1000266</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"stopType"</span>: <span style="color: #CC9393;">"stop"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"url"</span>: <span style="color: #CC9393;">"https:\/\/api-neon.tfl.gov.uk\/StopPoint\/HUBWSM"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"commonName"</span>: <span style="color: #CC9393;">"Westminster (London), Westminster"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"placeType"</span>: <span style="color: #CC9393;">"StopPoint"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"additionalProperties"</span>: <span style="color: #94BFF3;">[]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lat"</span>: <span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">50139978595</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lon"</span>: -<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">12490128591</span>
        <span style="color: #9FC59F;">}</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"matchQuality"</span>: <span style="color: #BFEBBF;">1000</span>
      <span style="color: #93E0E3;">}</span>,
      <span style="color: #93E0E3;">{</span>
        <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.DisambiguationOption, Tfl.Api.Presentation.Entities"</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"parameterValue"</span>: "<span style="color: #BFEBBF;">1002085</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"uri"</span>: "\/journey\/journeyresults\/bank\/to\/<span style="color: #BFEBBF;">1002085</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"place"</span>: <span style="color: #9FC59F;">{</span>
          <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.StopPoint, Tfl.Api.Presentation.Entities"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"naptanId"</span>: "<span style="color: #BFEBBF;">930GWMR</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"modes"</span>: <span style="color: #94BFF3;">[</span>
            <span style="color: #CC9393;">"river-bus"</span>
          <span style="color: #94BFF3;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"icsCode"</span>: "<span style="color: #BFEBBF;">1002085</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"stopType"</span>: <span style="color: #CC9393;">"stop"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"url"</span>: "https:\/\/api-neon.tfl.gov.uk\/StopPoint\/<span style="color: #BFEBBF;">930GWMR</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"commonName"</span>: <span style="color: #CC9393;">"Westminster (London), Westminster Pier"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"placeType"</span>: <span style="color: #CC9393;">"StopPoint"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"additionalProperties"</span>: <span style="color: #94BFF3;">[]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lat"</span>: <span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">50181087832</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lon"</span>: -<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">12361646769000001</span>
        <span style="color: #9FC59F;">}</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"matchQuality"</span>: <span style="color: #BFEBBF;">967</span>
        <span style="color: #93E0E3;">}</span>
    <span style="color: #D0BF8F;">]</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"matchStatus"</span>: <span style="color: #CC9393;">"list"</span>
  <span style="color: #BFEBBF;">}</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"fromLocationDisambiguation"</span>: <span style="color: #BFEBBF;">{</span>
    <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Disambiguation, Tfl.Api.Presentation.Entities"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"disambiguationOptions"</span>: <span style="color: #D0BF8F;">[</span>
      <span style="color: #93E0E3;">{</span>
        <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.DisambiguationOption, Tfl.Api.Presentation.Entities"</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"parameterValue"</span>: "<span style="color: #BFEBBF;">1000013</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"uri"</span>: "\/journey\/journeyresults\/<span style="color: #BFEBBF;">1000013</span>\/to\/westminster",
        <span style="color: #F0DFAF; font-weight: bold;">"place"</span>: <span style="color: #9FC59F;">{</span>
          <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.StopPoint, Tfl.Api.Presentation.Entities"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"naptanId"</span>: <span style="color: #CC9393;">"HUBBAN"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"modes"</span>: <span style="color: #94BFF3;">[</span>
            <span style="color: #CC9393;">"dlr"</span>,
            <span style="color: #CC9393;">"tube"</span>
          <span style="color: #94BFF3;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"icsCode"</span>: "<span style="color: #BFEBBF;">1000013</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"stopType"</span>: <span style="color: #CC9393;">"stop"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"url"</span>: <span style="color: #CC9393;">"https:\/\/api-neon.tfl.gov.uk\/StopPoint\/HUBBAN"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"commonName"</span>: <span style="color: #CC9393;">"City of London, Bank"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"placeType"</span>: <span style="color: #CC9393;">"StopPoint"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"additionalProperties"</span>: <span style="color: #94BFF3;">[]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lat"</span>: <span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">513389043480004</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lon"</span>: -<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">08882541444</span>
        <span style="color: #9FC59F;">}</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"matchQuality"</span>: <span style="color: #BFEBBF;">1000</span>
      <span style="color: #93E0E3;">}</span>,
      <span style="color: #93E0E3;">{</span>
        <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.DisambiguationOption, Tfl.Api.Presentation.Entities"</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"parameterValue"</span>: "<span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">66151925957</span>,-<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">09419500928</span>",
        <span style="color: #F0DFAF; font-weight: bold;">"uri"</span>: "\/journey\/journeyresults\/<span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">66151925957</span>,-<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">09419500928</span>\/to\/westminster",
        <span style="color: #F0DFAF; font-weight: bold;">"place"</span>: <span style="color: #9FC59F;">{</span>
          <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.Place, Tfl.Api.Presentation.Entities"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"url"</span>: <span style="color: #CC9393;">"https:\/\/api-neon.tfl.gov.uk\/Place\/"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"commonName"</span>: <span style="color: #CC9393;">"Bankside, Enfield (London)"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"placeType"</span>: <span style="color: #CC9393;">"StopPoint"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"additionalProperties"</span>: <span style="color: #94BFF3;">[]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lat"</span>: <span style="color: #BFEBBF;">51</span>.<span style="color: #BFEBBF;">66151925957</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"lon"</span>: -<span style="color: #BFEBBF;">0</span>.<span style="color: #BFEBBF;">09419500927999999</span>
        <span style="color: #9FC59F;">}</span>,
        <span style="color: #F0DFAF; font-weight: bold;">"matchQuality"</span>: <span style="color: #BFEBBF;">964</span>
      <span style="color: #93E0E3;">}</span>
     <span style="color: #D0BF8F;">]</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"matchStatus"</span>: <span style="color: #CC9393;">"list"</span>
  <span style="color: #BFEBBF;">}</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"viaLocationDisambiguation"</span>: <span style="color: #BFEBBF;">{</span>
    <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Disambiguation, Tfl.Api.Presentation.Entities"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"matchStatus"</span>: <span style="color: #CC9393;">"empty"</span>
  <span style="color: #BFEBBF;">}</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"recommendedMaxAgeMinutes"</span>: <span style="color: #BFEBBF;">1440</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"searchCriteria"</span>: <span style="color: #BFEBBF;">{</span>
    <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.SearchCriteria, Tfl.Api.Presentation.Entities"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"dateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T11</span>:<span style="color: #BFEBBF;">32</span>:<span style="color: #BFEBBF;">00</span>",
    <span style="color: #F0DFAF; font-weight: bold;">"dateTimeType"</span>: <span style="color: #CC9393;">"Departing"</span>
  <span style="color: #BFEBBF;">}</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"journeyVector"</span>: <span style="color: #BFEBBF;">{</span>
    <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.JourneyVector, Tfl.Api.Presentation.Entities"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"from"</span>: <span style="color: #CC9393;">"Bank"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"to"</span>: <span style="color: #CC9393;">"Westminster"</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"via"</span>: <span style="color: #CC9393;">""</span>,
    <span style="color: #F0DFAF; font-weight: bold;">"uri"</span>: <span style="color: #CC9393;">"\/journey\/journeyresults\/bank\/to\/westminster"</span>
  <span style="color: #BFEBBF;">}</span>
<span style="color: #DCDCCC;">}</span>
</pre>
</div>

<p>
The issue is, that for stops you would need to send the <code>icsCode</code> and for others the latitude and longitude data.
I discovered that you can always take the latitude and longitude data for an unambiguous result.
The only issue is that the journey will always include a 10m - 50m walk at the beginning and end.
</p>

<p>
I noticed that sometimes emacs wouldn't call my callback after the response was received.
It just got stuck waiting for more from the server.
After activating the <code>url-http-debug</code> mode, I noticed that this happens with 300s status codes.
<code>url-retrieve</code> will get stuck in "Spinning waiting for headers", which never
completes so the callback is never called.
The <code>url-http-parse-headers</code> function doesn't handle the 300 status code, well.
So I had to override the function to simply set <code>success</code> to <code>t</code> for said status code.
Curiously at first it still worked randomly without that fix.
</p>

<p>
Now once you request your journey with unique locations you get a proper result back:
</p>

<div class="org-src-container">

<pre class="src src-json"><span style="color: #DCDCCC;">{</span>
  <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.ItineraryResult, Tfl.Api.Presentation.Entities"</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"journeys"</span>: <span style="color: #BFEBBF;">[</span>
    <span style="color: #D0BF8F;">{</span>
      <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Journey, Tfl.Api.Presentation.Entities"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"startDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T12</span>:<span style="color: #BFEBBF;">57</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"duration"</span>: <span style="color: #BFEBBF;">13</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"arrivalDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T13</span>:<span style="color: #BFEBBF;">10</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"legs"</span>: <span style="color: #93E0E3;">[</span>...<span style="color: #93E0E3;">]</span>
    <span style="color: #D0BF8F;">}</span>,
    <span style="color: #D0BF8F;">{</span>
      <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Journey, Tfl.Api.Presentation.Entities"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"startDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T12</span>:<span style="color: #BFEBBF;">58</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"duration"</span>: <span style="color: #BFEBBF;">13</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"arrivalDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T13</span>:<span style="color: #BFEBBF;">11</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"legs"</span>: <span style="color: #93E0E3;">[</span>...<span style="color: #93E0E3;">]</span>
    <span style="color: #D0BF8F;">}</span>,
    <span style="color: #D0BF8F;">{</span>
      <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Journey, Tfl.Api.Presentation.Entities"</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"startDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T13</span>:<span style="color: #BFEBBF;">02</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"duration"</span>: <span style="color: #BFEBBF;">12</span>,
      <span style="color: #F0DFAF; font-weight: bold;">"arrivalDateTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T13</span>:<span style="color: #BFEBBF;">14</span>:<span style="color: #BFEBBF;">00</span>",
      <span style="color: #F0DFAF; font-weight: bold;">"legs"</span>: <span style="color: #93E0E3;">[</span>...<span style="color: #93E0E3;">]</span>
    <span style="color: #D0BF8F;">}</span>
  <span style="color: #BFEBBF;">]</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"lines"</span>: <span style="color: #BFEBBF;">[</span>...<span style="color: #BFEBBF;">]</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"recommendedMaxAgeMinutes"</span>: <span style="color: #BFEBBF;">4</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"searchCriteria"</span>: <span style="color: #BFEBBF;">{</span>...<span style="color: #BFEBBF;">}</span>,
  <span style="color: #F0DFAF; font-weight: bold;">"journeyVector"</span>: <span style="color: #BFEBBF;">{</span>...<span style="color: #BFEBBF;">}</span>
<span style="color: #DCDCCC;">}</span>
</pre>
</div>

<p>
The intersting parts are the journeys and especially their <code>legs</code> list.
Also <code>lines</code> can is usefull to get information about disruption.
</p>

<p>
So with this list of journeys we already know when to leave and when we arrive.
But we don't know how to get there.
That's where <code>legs</code> become important. They provide very indepth information.
</p>

<div class="org-src-container">

<pre class="src src-json"><span style="color: #F0DFAF; font-weight: bold;">"legs"</span>: <span style="color: #DCDCCC;">[</span>
        <span style="color: #BFEBBF;">{</span>
          <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.JourneyPlanner.Leg, Tfl.Api.Presentation.Entities"</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"duration"</span>: <span style="color: #BFEBBF;">5</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"instruction"</span>: <span style="color: #D0BF8F;">{</span>
            <span style="color: #F0DFAF; font-weight: bold;">"$type"</span>: <span style="color: #CC9393;">"Tfl.Api.Presentation.Entities.Instruction, Tfl.Api.Presentation.Entities"</span>,
            <span style="color: #F0DFAF; font-weight: bold;">"summary"</span>: <span style="color: #CC9393;">"Jubilee line to London Bridge"</span>,
            <span style="color: #F0DFAF; font-weight: bold;">"detailed"</span>: <span style="color: #CC9393;">"Jubilee line towards Stratford, or North Greenwich"</span>,
            <span style="color: #F0DFAF; font-weight: bold;">"steps"</span>: <span style="color: #93E0E3;">[]</span>
          <span style="color: #D0BF8F;">}</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"obstacles"</span>: <span style="color: #D0BF8F;">[</span>...<span style="color: #D0BF8F;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"departureTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T12</span>:<span style="color: #BFEBBF;">57</span>:<span style="color: #BFEBBF;">00</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"arrivalTime"</span>: "<span style="color: #BFEBBF;">2016</span>-<span style="color: #BFEBBF;">04</span>-<span style="color: #BFEBBF;">24T13</span>:<span style="color: #BFEBBF;">02</span>:<span style="color: #BFEBBF;">00</span>",
          <span style="color: #F0DFAF; font-weight: bold;">"departurePoint"</span>: <span style="color: #D0BF8F;">{</span>...<span style="color: #D0BF8F;">}</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"arrivalPoint"</span>: <span style="color: #D0BF8F;">{</span>...<span style="color: #D0BF8F;">}</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"path"</span>: <span style="color: #D0BF8F;">{</span>...<span style="color: #D0BF8F;">}</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"routeOptions"</span>: <span style="color: #D0BF8F;">[</span>...<span style="color: #D0BF8F;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"mode"</span>: <span style="color: #D0BF8F;">{</span>...<span style="color: #D0BF8F;">}</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"disruptions"</span>: <span style="color: #D0BF8F;">[</span>...<span style="color: #D0BF8F;">]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"plannedWorks"</span>: <span style="color: #D0BF8F;">[]</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"isDisrupted"</span>: <span style="color: #BFEBBF;">true</span>,
          <span style="color: #F0DFAF; font-weight: bold;">"hasFixedLocations"</span>: <span style="color: #BFEBBF;">true</span>
        <span style="color: #BFEBBF;">}</span>,
        ...
      <span style="color: #DCDCCC;">]</span>
</pre>
</div>

<p>
So here we actually get not only instructions generated for us, but also
a list of obstacles (e.g. elevator is out of order), the path with exact geo locations,
disruptions and planned work information and more.
</p>

<p>
It's only a matter of parsing the information and presenting it to the user.
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-2">
<h2 id="orgheadline7">Org Mode</h2>
<div class="outline-text-2" id="text-orgheadline7">
</div><div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">Links</h3>
<div class="outline-text-3" id="text-orgheadline3">
<p>
<code>org-mode</code> has a great feature for links. Depending on the protocol (e.g. http or file) in the url
<code>org-mode</code> uses a different handler function and you can extend those with your own link types.
I added a handler for <code>org-tfl:</code> links.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #DCDCCC;">(</span>org-add-link-type <span style="color: #CC9393;">"org-tfl"</span> 'org-tfl-jp-open-org-link<span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
The handler function simplified looks like this:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">org-tfl-jp-open-org-link</span> <span style="color: #BFEBBF;">(</span><span style="color: #7CB8BB;">&amp;optional</span> path<span style="color: #BFEBBF;">)</span>
  <span style="color: #9FC59F;">"Open a org-tfl link.  PATH is ignored.  Properties of the paragraph are used instead."</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">let*</span> <span style="color: #D0BF8F;">(</span><span style="color: #93E0E3;">(</span>element <span style="color: #9FC59F;">(</span>org-element-at-point<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
   <span style="color: #93E0E3;">(</span>FROM <span style="color: #9FC59F;">(</span>org-element-property <span style="color: #DCDCCC; font-weight: bold;">:FROM</span> element<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
   <span style="color: #93E0E3;">(</span>TO <span style="color: #9FC59F;">(</span>org-element-property <span style="color: #DCDCCC; font-weight: bold;">:TO</span> element<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
   <span style="color: #93E0E3;">(</span>VIA <span style="color: #9FC59F;">(</span>org-element-property <span style="color: #DCDCCC; font-weight: bold;">:VIA</span> element<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
   <span style="color: #93E0E3;">(</span>SCHEDULED <span style="color: #9FC59F;">(</span>org-get-scheduled-time <span style="color: #94BFF3;">(</span>point<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #F0DFAF; font-weight: bold;">when</span> SCHEDULED
      <span style="color: #93E0E3;">(</span>setq DATE <span style="color: #9FC59F;">(</span>format-time-string <span style="color: #CC9393;">"%Y%m%d"</span> SCHEDULED<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
      <span style="color: #93E0E3;">(</span>setq TIME <span style="color: #9FC59F;">(</span>format-time-string <span style="color: #CC9393;">"%H%M"</span> SCHEDULED<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span>org-tfl-jp-retrieve-org
     FROM TO <span style="color: #DCDCCC; font-weight: bold;">:via</span> VIA <span style="color: #DCDCCC; font-weight: bold;">:date</span> DATE <span style="color: #DCDCCC; font-weight: bold;">:time</span> TIME<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
This assumes that the link is part of a heading and the paragraph has some special properties.
I have a nother function which writes these links and properties automatically.
</p>

<div class="org-src-container">

<pre class="src src-org">\*\* <span style="color: #D0BF8F; text-decoration: underline;"><a href="org-tfl:">[[org-tfl:][</a><a href="org-tfl:">Retrieving Information...</a><a href="org-tfl:">]]</a></span>
  <span style="color: #7F9F7F;">SCHEDULED:</span> <span style="color: #8CD0D3; text-decoration: underline;">&lt;2016-04-24 So 13:59&gt;</span>
<span style="color: #7F9F7F;">  :PROPERTIES:</span>
  <span style="color: #7F9F7F;">:FROM:</span>     Picadilly Circus
  <span style="color: #7F9F7F;">:TO:</span>       Liverpool Street
  <span style="color: #7F9F7F;">:TIMEIS:</span>   Departing
<span style="color: #7F9F7F;">  :END:</span>
</pre>
</div>

<p>
Once all the results are retrieved, I come back to the opened link, and replace the
link description, paragraph and properties with the parsed result.
</p>


<div class="figure">
<p><img src="/assets/blog/2016/04/24/transport-for-london-with-emacs-org-mode/itinerary_result.png" alt="/assets/blog/2016/04/24/transport-for-london-with-emacs-org-mode/itinerary_result.png" />
</p>
</div>

<p>
The link can be opened again to update the result.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4">Icons</h3>
<div class="outline-text-3" id="text-orgheadline4">
<p>
All icons are svg which are inserted via text properties.
I collected loads of those svg icons and had to modify them by hand.
Most of the time it's a simple resize.
Emacs can edit svgs in plain text. They are like xml.
</p>

<div class="org-src-container">

<pre class="src src-nxml">&lt;?<span style="color: #F0DFAF; font-weight: bold;">xml</span> <span style="color: #DFAF8F;">version</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">1.0</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">encoding</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">iso-8859-1</span><span style="color: #CC9393;">"</span>?&gt;
&lt;<span style="color: #93E0E3;">svg</span> <span style="color: #DCDCCC; font-weight: bold;">xmlns</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">http://www.w3.org/2000/svg</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">width</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">18</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">height</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">20</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">viewBox</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">0 0 640 520</span><span style="color: #CC9393;">"</span>&gt;
  &lt;<span style="color: #93E0E3;">title</span>&gt;London DLR&lt;/<span style="color: #93E0E3;">title</span>&gt;
  &lt;<span style="color: #93E0E3;">g</span> <span style="color: #DFAF8F;">stroke</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">#009999</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">fill</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">none</span><span style="color: #CC9393;">"</span>&gt;
    &lt;<span style="color: #93E0E3;">circle</span> <span style="color: #DFAF8F;">cx</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">320</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">cy</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">260</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">r</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">215</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">stroke-width</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">90</span><span style="color: #CC9393;">"</span>/&gt;
  &lt;/<span style="color: #93E0E3;">g</span>&gt;
  &lt;<span style="color: #93E0E3;">g</span> <span style="color: #DFAF8F;">stroke</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">#0019a8</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">fill</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">none</span><span style="color: #CC9393;">"</span>&gt;
    &lt;<span style="color: #93E0E3;">path</span> <span style="color: #DFAF8F;">d</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">M 0,260 H 640</span><span style="color: #CC9393;">"</span> <span style="color: #DFAF8F;">stroke-width</span>=<span style="color: #CC9393;">"</span><span style="color: #CC9393;">100</span><span style="color: #CC9393;">"</span> /&gt;
  &lt;/<span style="color: #93E0E3;">g</span>&gt;
&lt;/<span style="color: #93E0E3;">svg</span>&gt;
</pre>
</div>

<p>
To resize an image, it's best to add the <code>viewBox</code> attribute with the original size.
Then you can easily adjust <code>height</code> and <code>width</code> to your liking without having to worry about
positioning or aspect ratio.
</p>

<p>
The downside is, that the images and icons don't scale at the moment.
So it only works for one font and font size.
</p>

<p>
Now when you have the path to an svg or png image file, all you need to insert it in a buffer is:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #DCDCCC;">(</span>insert
 <span style="color: #BFEBBF;">(</span>propertize <span style="color: #CC9393;">"  "</span> 'display
  <span style="color: #D0BF8F;">(</span>create-image
   <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">with-temp-buffer</span> <span style="color: #9FC59F;">(</span>insert-file-contents <span style="color: #CC9393;">"path/to/image.svg"</span><span style="color: #9FC59F;">)</span> <span style="color: #9FC59F;">(</span>buffer-string<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
   'svg t <span style="color: #DCDCCC; font-weight: bold;">:ascent</span> <span style="color: #BFEBBF;">80</span> <span style="color: #DCDCCC; font-weight: bold;">:mask</span> 'heuristic<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>
<p>
The string can be an alternate string for when you don't display images. But it should have roughly the same
width as the image for best results.
The <code>ascent</code> of 80 was perfect for my font size.
The <code>mask</code> value <code>heuristic</code> is needed to make transparency work.
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">Underground Line Color</h3>
<div class="outline-text-3" id="text-orgheadline5">
<p>
TfL has a very well thought out corporate style guide. Every color is well defined for each
use-case.
You can read the full specification <a href="http://content.tfl.gov.uk/tfl-colour-standard.pdf">here</a>.
I wanted to make the tube line names highlighted with their respective color.
This can be done by adding <code>font-lock</code> keywords.
</p>

<p>
First you need a faces with the right colors and a mapping to their names.
Then you add it to the keywords:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">...

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defface</span> <span style="color: #DFAF8F;">org-tfl-waterloo-face</span>
  '<span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span>t <span style="color: #93E0E3;">(</span><span style="color: #DCDCCC; font-weight: bold;">:foreground</span> <span style="color: #CC9393;">"white"</span> <span style="color: #DCDCCC; font-weight: bold;">:background</span> <span style="color: #CC9393;">"#66CCCC"</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>
  <span style="color: #9FC59F;">"Waterloo and City Line Face"</span>
  <span style="color: #DCDCCC; font-weight: bold;">:group</span> 'org-tfl<span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defvar</span> <span style="color: #DFAF8F;">org-tfl-line-faces</span>
  '<span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Bakerloo line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-bakerloo-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Central line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-central-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Circle line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-circle-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"District line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-district-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Hammersmith &amp; City line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-hammersmith-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Jubilee line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-jubliee-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Metropolitan line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-metropolitan-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Northern line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-northern-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Piccadilly line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-piccadilly-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Victoria line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-victoria-face prepend<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #CC9393;">"Waterloo and City line"</span> <span style="color: #BFEBBF;">0</span> 'org-tfl-waterloo-face prepend<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>
  <span style="color: #9FC59F;">"Mapping of lines to faces."</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>font-lock-add-keywords 'org-mode org-tfl-line-faces t<span style="color: #DCDCCC;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Maps</h3>
<div class="outline-text-3" id="text-orgheadline6">
<p>
What's really cool about the TfL API are the paths with exact geo locations.
You can use those to draw a map. If you have access to the google maps api, you could
create a route and give the user a link to an interactive map.
But in Emacs we need static images. Luckily the google maps API also features static maps.
All you need is a crafted url with all the geo positions.
The positions have to be concatenated with the pipe character.
The first and last positions should be used as marker positions.
</p>

<pre class="example">
https://maps.google.com/maps/api/staticmap?size=800x800&amp;maptype=roadmap&amp;path=color:0xff0000ff|weight:5|51.51538417456,-0.14134847217|51.51558212527,-0.13965411967&amp;markers=label:S|color:blue|51.51538417456,-0.14134847217&amp;markers=label:E|color:red|51.51558212527,-0.13965411967
</pre>

<p>
You can either insert that link in as an org link or download the picture to a temp location and
create a link to that temp file. This enables inline images.
</p>

<p>
Careful though. The link can only be roughly around 2000 characters long.
For long paths you have to split them up and create several links.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8">Final Result</h2>
<div class="outline-text-2" id="text-orgheadline8">
<p>
Turns out the tfl package can be really useful.
The headings show up in your agenda view and allow for a quick check for when you have to leave.
I made it available on <a href="https://melpa.org/#/org-tfl">melpa</a> and of course <a href="https://github.com/storax/org-tfl">github</a>.
</p>


<div class="figure">
<p><img src="/assets/blog/2016/04/24/transport-for-london-with-emacs-org-mode/maps.png" alt="/assets/blog/2016/04/24/transport-for-london-with-emacs-org-mode/maps.png" />
</p>
</div>

<p>
Now turns out, after a week you know your commute and trains go every 2 minutes, so I actually don't use
it anymore.
</p>

<p>
The same concept could be applied to other public transportation APIs or the Google Maps API.
This would make it available for a broader audience.
Anyway I learned a lot and it was quite fun.
</p>
</div>
</div>

    </div>
</div>

        <div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-04-24</span>
            <span title="last modification date" class="post-info">2016-05-01</span>
            <span title="tags" class="post-info"><a href="/tags/emacs/">Emacs</a>, <a href="/tags/org-mode/">org-mode</a>, <a href="/tags/tfl/">tfl</a>, <a href="/tags/london/">London</a>, <a href="/tags/emacs-lisp/">emacs-lisp</a>, <a href="/tags/svg/">svg</a></span>
            <span title="author" class="post-info">David Zuber</span>
        </div>
        <section>
            <h1>Comments</h1>
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                 //var disqus_developer = 1;
                 var disqus_identifier = "/blog/2016/04/24/transport-for-london-with-emacs-org-mode";
                 var disqus_url = "https://storax.github.io/blog/2016/04/24/transport-for-london-with-emacs-org-mode";
                 var disqus_shortname = 'storaxgithubio';
                 /* * * DON'T EDIT BELOW THIS LINE * * */
                 (function() {
                     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                 })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>
    <script src="//code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
            Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:zuber &lt;dot&gt; david &lt;at&gt; gmx &lt;dot&gt; de">David Zuber</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
</div>

    </body>
</html>
